[all:vars]
ansible_user={{ item.username }}
ansible_ssh_pass={{ admin_password }}
{% if ssh_port is defined %}
ansible_port={{ ssh_port }}
{% endif %}

[routers]
{% for vm in rtr1_output.results %}
{% if item.username in vm.invocation.module_args.instance_tags.Name %}
{{ vm.invocation.module_args.instance_tags.Name | regex_replace('.*-([\\w]*)', '\\1') }} ansible_host={{ vm.tagged_instances[0].public_ip }} ansible_ssh_user={{ ec2_login_names[rtr1_node] }} private_ip={{ vm.tagged_instances[0].private_ip }}
{% endif %}
{% endfor %}
{% for vm in rtr2_output.results %}
{% if item.username in vm.invocation.module_args.instance_tags.Name %}
{{ vm.invocation.module_args.instance_tags.Name | regex_replace('.*-([\\w]*)', '\\1') }} ansible_host={{ vm.tagged_instances[0].public_ip }} ansible_ssh_user={{ ec2_login_names[rtr2_node] }} private_ip={{ vm.tagged_instances[0].private_ip }}
{% endif %}
{% endfor %}
[hosts]
{% for vm in host1_output.results %}
{% if item.username in vm.invocation.module_args.instance_tags.Name %}
{{ vm.invocation.module_args.instance_tags.Name | regex_replace('.*-([\\w]*)', '\\1') }} ansible_host={{ vm.tagged_instances[0].public_ip }} ansible_ssh_user={{ ec2_login_names[host1_node] }} private_ip={{ vm.tagged_instances[0].private_ip }}
{% endif %}
{% endfor %}
[control]
{% for vm in control_output.results %}
{% if item.username in vm.invocation.module_args.instance_tags.Name %}
{{ vm.invocation.module_args.instance_tags.Name | regex_replace('.*-([\\w]*)', '\\1') }} ansible_host={{ vm.tagged_instances[0].public_ip }} ansible_ssh_user={{ ec2_login_names[ansible_node] }} private_ip={{ vm.tagged_instances[0].private_ip }}
{% endif %}
{% endfor %}
