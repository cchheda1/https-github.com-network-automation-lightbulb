[all:vars]
{% if ssh_port is defined %}
ansible_port={{ ssh_port }}
{% endif %}

{% for user in users %}
[{{ user.username }}]
{% for host in control_output.results %}
{% if host.skipped is not defined and user.username in host.invocation.module_args.instance_tags.Name %}
{{ host.invocation.module_args.instance_tags.Name | regex_replace(ec2_name_prefix ~ '-','') }} ansible_host={{ host.tagged_instances[0].public_ip }} ansible_user={{ec2_login_names[ansible_node] }}
{% endif %}
{% endfor %}
{% for host in rtr1_output.results %}
{% if host.skipped is not defined and user.username in host.invocation.module_args.instance_tags.Name %}
{{ host.invocation.module_args.instance_tags.Name | regex_replace(ec2_name_prefix ~ '-','') }} ansible_host={{ host.tagged_instances[0].public_ip }} ansible_user={{ec2_login_names[rtr1_node] }}
{% endif %}
{% endfor %}
{% for host in rtr2_output.results %}
{% if host.skipped is not defined and user.username in host.invocation.module_args.instance_tags.Name %}
{{ host.invocation.module_args.instance_tags.Name | regex_replace(ec2_name_prefix ~ '-','') }} ansible_host={{ host.tagged_instances[0].public_ip }} ansible_user={{ec2_login_names[rtr2_node] }}
{% endif %}
{% endfor %}
{% for host in host1_output.results %}
{% if host.skipped is not defined and user.username in host.invocation.module_args.instance_tags.Name %}
{{ host.invocation.module_args.instance_tags.Name | regex_replace(ec2_name_prefix ~ '-','') }} ansible_host={{ host.tagged_instances[0].public_ip }} ansible_user={{ec2_login_names[host1_node] }}
{% endif %}
{% endfor %}
{% endfor %}
